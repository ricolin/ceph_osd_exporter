- job:
    name: ceph-osd-exporter-build-container-image
    parent: ci-build-container-image
    vars: &container_image_vars
      promote_container_image_job: ceph-osd-exporter-upload-container-image
      container_images:
        - context: .
          registry: registry.atmosphere.dev
          repository: registry.atmosphere.dev/library/ceph-osd-exporter
          arch:
            - linux/amd64
          tags:
            - "{{ zuul.commit_id }}"
            - "{{ zuul.tag is defined | ternary(zuul.tag, 'latest') }}"

- job:
    name: ceph-osd-exporter-upload-container-image
    parent: ci-upload-container-image
    vars: *container_image_vars

- job:
    name: ceph-osd-exporter-promote-container-image
    parent: ci-promote-container-image
    vars: *container_image_vars


- job:
    name: ceph-osd-exporter-linters
    parent: tox-linters
    pre-run: zuul.d/playbooks/linters/pre.yml

- job:
    name: ceph-osd-exporter-molecule-base
    parent: tox
    abstract: true
    timeout: 7200
    nodeset:
      nodes:
        - name: ubuntu-jammy
          label: jammy-16c-64g
    pre-run: zuul.d/playbooks/molecule/pre.yml
    run: zuul.d/playbooks/molecule/run.yml
    post-run: zuul.d/playbooks/molecule/post.yml

- job:
    name: ceph-osd-exporter-molecule-aio
    parent: ceph-osd-exporter-molecule-base
    vars:
      tox_envlist: molecule-aio-openvswitch
